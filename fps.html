<!doctype html>
<html lang='nl'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>FPS Shooter</title>
<link rel='stylesheet' href='css/style.css'>
</head>
<body class='neon-bg'>
<div id='ui' style='position:fixed;left:12px;top:12px;z-index:6;color:#fff'><a class='btn' href='index.html'>← Terug</a></div>
<script type='module'>
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js';
/* FPS module */
import { PointerLockControls } from "https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/controls/PointerLockControls.js";
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({antialias:true, powerPreference:"high-performance"});
renderer.setSize(innerWidth, innerHeight); document.body.appendChild(renderer.domElement);
window.addEventListener("resize", ()=>{ camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
scene.add(new THREE.AmbientLight(0x888888));
const dir = new THREE.DirectionalLight(0xffffff,1); dir.position.set(5,10,7); scene.add(dir);

let player = null;
(async()=>{
  const gl = await loadGLTF('assets/models/player.glb');
  if(gl && gl.scene){ player = gl.scene; player.scale.set(1.0,1.0,1.0); player.position.set(0,0.9,0); scene.add(player); }
  else {
    player = new THREE.Mesh(new THREE.BoxGeometry(1.2,1.6,0.6), new THREE.MeshStandardMaterial({color:0x55aaff}));
    player.position.set(0,0.9,0); scene.add(player);
  }
})();

camera.position.set(0,6,9); camera.lookAt(0,0,0);
let bullets = [], enemies = [], spawnT=0, hp=100, kills=0;
function spawnEnemy(){ const e = new THREE.Mesh(new THREE.BoxGeometry(1.2,1.4,0.8), new THREE.MeshStandardMaterial({color:0xff6b6b})); e.position.set((Math.random()-0.5)*60,0.8,(Math.random()*-80)-20); e.userData={hp:1}; scene.add(e); enemies.push(e); }
function shoot(dir){
  const b = new THREE.Mesh(new THREE.SphereGeometry(0.12), new THREE.MeshStandardMaterial({color:0xffdd55}));
  b.position.copy(player.position).add(new THREE.Vector3(0,0.9,0)); b.userData={vel:dir.multiplyScalar(55)}; scene.add(b); bullets.push(b); AudioHelper.beep(700,0.04,0.04,"square");
}
function update(dt, keys){
  // movement
  let forward = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion); forward.y=0; forward.normalize();
  let right = new THREE.Vector3().crossVectors(new THREE.Vector3(0,1,0), forward).normalize();
  let vx=0,vz=0;
  if(keys["w"]) { vx += forward.x*6; vz += forward.z*6; }
  if(keys["s"]) { vx -= forward.x*6; vz -= forward.z*6; }
  if(keys["a"]) { vx += right.x*6; vz += right.z*6; }
  if(keys["d"]) { vx -= right.x*6; vz -= right.z*6; }
  player.position.x += vx*dt; player.position.z += vz*dt;
  // bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b = bullets[i]; b.position.addScaledVector(b.userData.vel, dt);
    for(let j=enemies.length-1;j>=0;j--){
      const e=enemies[j];
      if(b.position.distanceTo(e.position) < 1.2){ e.userData.hp -= 1; scene.remove(b); bullets.splice(i,1); if(e.userData.hp<=0){ scene.remove(e); enemies.splice(j,1); kills++; } break; }
    }
    if(b.position.length() > 1000){ scene.remove(b); bullets.splice(i,1); }
  }
  // enemies
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i]; const dir = new THREE.Vector3().subVectors(player.position, e.position).setY(0).normalize();
    e.position.addScaledVector(dir, 1.5*dt*10);
    if(e.position.distanceTo(player.position) < 1.6){ hp -= 10; AudioHelper.beep(160,0.12,0.08); scene.remove(e); enemies.splice(i,1); if(hp<=0){ alert("You died - kills: "+kills); location.reload(); } }
  }
  spawnT += dt; if(spawnT > 1.2){ spawnEnemy(); spawnT = 0; }
}
function render(){ camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y+5, player.position.z+9), 0.08); camera.lookAt(player.position); renderer.render(scene, camera); }
const engine = new Engine((dt,keys)=>update(dt,keys), ()=>render());
window.addEventListener("click", (e)=>{ if(AudioHelper.ctx && AudioHelper.ctx.state === "suspended") AudioHelper.ctx.resume(); const mouse = new THREE.Vector2((e.clientX/innerWidth)*2-1, -(e.clientY/innerHeight)*2+1); const vec = new THREE.Vector3(mouse.x, mouse.y, 0.5).unproject(camera).sub(camera.position).normalize(); shoot(vec); });
</script>
</body>
</html>
